<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Block POS — Multi‑Seller</title>
<style>
  :root{
    --bg:#0f1117; --ink:#e6e8ef; --muted:#282c3a; --card:#171a24; --accent:#7fffb6; --bar:#000;
    --warn:#ffe28a; --danger:#ff7675; --ok:#7bed9f;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  .blk{background:var(--card);border:1px solid var(--muted);border-radius:14px;padding:12px 14px;margin:12px 0}
  .bar{background:var(--bar);color:#fff;border-radius:10px;padding:10px 12px;font-weight:800;letter-spacing:.3px;margin-bottom:10px;display:flex;justify-content:center}
  .grid{display:grid;gap:10px}
  .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  label{font-size:12px;color:#aab0c0;display:block;margin-bottom:6px}
  input,select,button{background:#0e1222;border:1px solid var(--muted);color:var(--ink);border-radius:12px;padding:10px 12px;outline:0}
  input[readonly]{opacity:.9}
  .btn{background:var(--accent);color:#062015;border:0;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer}
  .btn.secondary{background:#2b324f;color:var(--ink)}
  .btn.danger{background:var(--danger);color:#2b0d0d}
  .box{background:#0c1020;border:1px solid var(--muted);border-radius:12px;padding:10px 12px}
  .h{font-weight:800}
  .right{text-align:right}
  .mono{font-variant-numeric:tabular-nums}
  .pill{display:inline-flex;gap:8px;align-items:center;background:#0e1429;border:1px dashed var(--muted);padding:6px 10px;border-radius:999px;font-size:12px;color:#aab0c0}
  .small{font-size:12px;color:#aab0c0}
  .line{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
  .line span{opacity:.9}
  .line button{padding:8px 10px}
</style>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f1117">
  <link rel="apple-touch-icon" href="icon-192.png">

</head>
<body>
  <div class="wrap">

    <!-- Header with currency + seller selector -->
    <div class="row" style="justify-content:space-between;margin-bottom:8px">
      <div class="h" style="font-size:20px">Block POS — Multi‑Seller</div>
      <div class="row">
        <label style="margin:0">Currency</label>
        <input id="currency" value="$" style="width:60px;text-align:center">
      </div>
    </div>

    <div class="blk">
      <div class="bar">SELLER</div>
      <div class="row">
        <div class="row">
          <label style="margin:0">Choose Seller</label>
          <select id="sellerSelect"></select>
        </div>
        <div class="row">
          <input id="newSellerName" placeholder="Add new seller...">
          <button class="btn" id="addSellerBtn">Add Seller</button>
          <button class="btn danger" id="deleteSellerBtn" title="Delete current seller">Delete</button>
        </div>
        <div class="pill">Each seller has their own numbers and entries</div>
      </div>
    </div>

    <!-- Block 4: Price Breakdown FIRST -->
    <div class="blk">
      <div class="bar">PRICE BREAKDOWN (per unit)</div>
      <div class="grid grid-3">
        <div>
          <label>Original Price</label>
          <input id="orig" type="number" step="0.01" min="0">
        </div>
        <div>
          <label>Markup</label>
          <input id="markup" type="number" step="0.01" min="0">
        </div>
        <div>
          <label>New Price (auto)</label>
          <input id="newPrice" class="mono" readonly>
        </div>
      </div>
    </div>

    <!-- Block 3: Expected Total SECOND -->
    <div class="blk">
      <div class="bar">EXPECTED TOTAL</div>
      <div class="grid grid-3">
        <div>
          <label>Stock</label>
          <div class="row">
            <input id="stock" type="number" step="0.001" min="0" placeholder="e.g., 10">
            <input id="unit" placeholder="unit (bottle / g / ml / pcs)" style="min-width:160px">
          </div>
        </div>
        <div>
          <label>Unit Price (from Price Breakdown)</label>
          <input id="unitPrice" class="mono" readonly>
        </div>
        <div>
          <label>Expected Total (auto)</label>
          <input id="expected" class="mono" readonly>
        </div>
      </div>
    </div>

    <!-- Block 1: Receivable & Collections (with per-seller ledger) -->
    <div class="blk">
      <div class="bar">RECEIVABLE & COLLECTIONS</div>
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <label style="margin:0">Mode</label>
          <select id="mode">
            <option>By Cash</option>
            <option>By Stock</option>
          </select>
          <span class="pill small">Entries switch units automatically</span>
        </div>
        <div class="row">
          <label style="margin:0">Seller Needs to Pay</label>
          <input id="needsToPay" class="mono right" readonly style="min-width:180px">
        </div>
      </div>

      <div class="grid grid-2" style="margin-top:10px">
        <div>
          <label class="h">Money/Units Received — line by line (per seller)</label>
          <div class="row">
            <input id="entry" type="number" step="0.001" min="0" placeholder="e.g., 70">
            <button class="btn" id="add">Add</button>
            <button class="btn secondary" id="clear">Clear</button>
          </div>
          <div id="lines" style="margin-top:10px; display:grid; gap:6px"></div>
        </div>
        <div>
          <label class="h">TOTAL</label>
          <input id="totalDisplay" class="mono right" readonly>
          <div class="small" id="totalExplainer"></div>

          <div class="row" style="margin-top:16px">
            <div>
              <label>Money Left</label>
              <input id="moneyLeft" class="mono right" readonly>
            </div>
            <div>
              <label>Stock at Seller</label>
              <input id="stockLeft" class="mono right" readonly>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="small">Everything saves locally per seller (localStorage). No server required.</div>
  </div>

<script>
const $ = s => document.querySelector(s);
const currencyEl = $('#currency');

const origEl = $('#orig');
const markupEl = $('#markup');
const newPriceEl = $('#newPrice');

const stockEl = $('#stock');
const unitEl = $('#unit');
const unitPriceEl = $('#unitPrice');
const expectedEl = $('#expected');

const modeEl = $('#mode');
const needsEl = $('#needsToPay');

const entryEl = $('#entry');
const addBtn = $('#add');
const clearBtn = $('#clear');
const linesBox = $('#lines');
const totalDisplayEl = $('#totalDisplay');
const totalExplainerEl = $('#totalExplainer');
const moneyLeftEl = $('#moneyLeft');
const stockLeftEl = $('#stockLeft');

const sellerSelect = $('#sellerSelect');
const addSellerBtn = $('#addSellerBtn');
const deleteSellerBtn = $('#deleteSellerBtn');
const newSellerName = $('#newSellerName');

// --- Data model ---
// sellers = {
//   "Seller A": { orig, markup, stock, unit, mode, lines: [] }
// }
let sellers = {};
const KEY = 'block_pos_multiseller_v1';

function loadAll(){
  try{
    sellers = JSON.parse(localStorage.getItem(KEY) || '{}');
  }catch(e){ sellers = {}; }
  if(!Object.keys(sellers).length){
    sellers = { "Seller A": {orig:50, markup:50, stock:10, unit:"bottle", mode:"By Cash", lines:[]} };
  }
  refreshSellerOptions();
}
function saveAll(){
  localStorage.setItem(KEY, JSON.stringify(sellers));
}

function refreshSellerOptions(){
  const cur = sellerSelect.value;
  sellerSelect.innerHTML = '';
  Object.keys(sellers).forEach(name => {
    const opt = document.createElement('option');
    opt.value = name; opt.textContent = name;
    sellerSelect.appendChild(opt);
  });
  sellerSelect.value = cur && sellers[cur] ? cur : Object.keys(sellers)[0];
  loadSeller(sellerSelect.value);
}

function loadSeller(name){
  const s = sellers[name];
  if(!s) return;
  origEl.value   = s.orig ?? 0;
  markupEl.value = s.markup ?? 0;
  stockEl.value  = s.stock ?? 0;
  unitEl.value   = s.unit ?? '';
  modeEl.value   = s.mode ?? 'By Cash';
  lines = Array.isArray(s.lines) ? s.lines : [];
  recalc();
}

function saveSeller(name){
  if(!sellers[name]) sellers[name] = {};
  sellers[name].orig   = +origEl.value || 0;
  sellers[name].markup = +markupEl.value || 0;
  sellers[name].stock  = +stockEl.value || 0;
  sellers[name].unit   = unitEl.value || '';
  sellers[name].mode   = modeEl.value;
  sellers[name].lines  = lines.slice();
  saveAll();
}

let lines = []; // active seller's lines
function fmtMoney(n){
  const sym = currencyEl.value || '$';
  const v = isFinite(+n) ? (+n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}) : '0.00';
  return `${sym}${v}`;
}
function fmtQty(n){ return isFinite(+n) ? (+n).toLocaleString(undefined,{maximumFractionDigits:3}) : '0'; }

function recalc(){
  // Price breakdown
  const op = +origEl.value || 0;
  const mk = +markupEl.value || 0;
  const price = op + mk;
  newPriceEl.value  = fmtMoney(price);

  // Expected
  const qty = +stockEl.value || 0;
  unitPriceEl.value = fmtMoney(price);
  expectedEl.value  = fmtMoney(qty * price);
  needsEl.value     = fmtMoney(qty * price);

  // Totals from entries
  const mode = modeEl.value;
  const total = lines.reduce((a,b)=>a+(+b||0),0);
  if(mode === 'By Cash'){
    totalDisplayEl.value = fmtMoney(total);
    totalExplainerEl.textContent = 'Sum of cash entries';
  }else{
    totalDisplayEl.value = `${fmtQty(total)} ${unitEl.value||''}`.trim();
    totalExplainerEl.textContent = 'Sum of units entries';
  }

  // Effective cash & units
  const effCash  = (mode === 'By Cash') ? total : total * price;
  const effUnits = (mode === 'By Stock') ? total : (price>0 ? total/price : 0);

  const expected = qty * price;
  const moneyLeft = expected - effCash;
  const stockLeft = (mode === 'By Stock') ? (qty - effUnits) : (price>0 ? moneyLeft/price : 0);

  moneyLeftEl.value = fmtMoney(moneyLeft);
  stockLeftEl.value = `${fmtQty(stockLeft)} ${unitEl.value||''}`.trim();

  renderLines();
  saveSeller(sellerSelect.value);
}

function renderLines(){
  linesBox.innerHTML = '';
  lines.forEach((val, idx)=>{
    const line = document.createElement('div');
    line.className = 'line';
    const left = document.createElement('span');
    left.className = 'mono';
    if(modeEl.value==='By Cash'){
      left.textContent = fmtMoney(val);
    }else{
      left.textContent = `${fmtQty(val)} ${unitEl.value||''}`.trim();
    }
    const btn = document.createElement('button');
    btn.className = 'btn danger';
    btn.textContent = 'Delete';
    btn.onclick = ()=>{ lines.splice(idx,1); recalc(); };
    line.appendChild(left);
    line.appendChild(btn);
    linesBox.appendChild(line);
  });
}

addBtn.onclick = ()=>{
  const v = +entryEl.value;
  if(!isFinite(v) || v<=0){ entryEl.focus(); return; }
  lines.unshift(v);
  entryEl.value='';
  recalc();
};
clearBtn.onclick = ()=>{
  if(confirm('Clear all entries for this seller?')){ lines=[]; recalc(); }
};

for(const el of [currencyEl,origEl,markupEl,stockEl,unitEl,modeEl]){
  el.addEventListener('input', recalc);
  el.addEventListener('change', recalc);
}

sellerSelect.addEventListener('change', ()=>loadSeller(sellerSelect.value));
addSellerBtn.addEventListener('click', ()=>{
  const name = (newSellerName.value || '').trim();
  if(!name) return;
  if(sellers[name]){ alert('Seller already exists'); return; }
  sellers[name] = {orig:50, markup:50, stock:10, unit:'bottle', mode:'By Cash', lines:[]};
  newSellerName.value='';
  saveAll();
  refreshSellerOptions();
  sellerSelect.value = name;
  loadSeller(name);
});
deleteSellerBtn.addEventListener('click', ()=>{
  const name = sellerSelect.value;
  if(Object.keys(sellers).length<=1){ alert('Keep at least one seller.'); return; }
  if(confirm(`Delete seller "${name}" and all its data?`)){
    delete sellers[name];
    saveAll();
    refreshSellerOptions();
  }
});

// init
loadAll();

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js');
  });
}

</script>
</body>
</html>